#!/bin/bash
# Check deployment status
# Usage: ./status

GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}ðŸ“Š Deployment Status${NC}"
echo "===================="
echo ""

# Git status
echo -e "${YELLOW}Local Changes:${NC}"
if [ -z "$(git status --porcelain)" ]; then
    echo "  âœ… No uncommitted changes"
else
    echo "  Uncommitted files:"
    git status --short | sed 's/^/  /'
fi
echo ""

# Commits ahead
AHEAD=$(git rev-list --count origin/main..HEAD 2>/dev/null || echo "0")
if [ "$AHEAD" -gt 0 ]; then
    echo -e "${YELLOW}Commits Ready to Push: $AHEAD${NC}"
    git log origin/main..HEAD --oneline | sed 's/^/  /'
else
    echo "âœ… Branch is up to date with origin/main"
fi
echo ""

# Last deployment
echo -e "${YELLOW}Latest Commits:${NC}"
git log -3 --oneline --decorate | sed 's/^/  /'
echo ""

# GitHub Actions status
echo -e "${YELLOW}GitHub Actions:${NC}"
if command -v gh &> /dev/null; then
    gh run list --limit 3 --workflow=deploy-integrated.yml 2>/dev/null || echo "  Run: gh auth login"
else
    echo "  View: https://github.com/hugh949/Gait-Analysis/actions"
fi
echo ""

# Azure status
echo -e "${YELLOW}Azure App Service:${NC}"
if command -v az &> /dev/null; then
    STATE=$(az webapp show --name gaitanalysisapp --resource-group gait-analysis-rg-wus3 --query state -o tsv 2>/dev/null || echo "unknown")
    echo "  Status: $STATE"
else
    echo "  View: https://portal.azure.com"
fi
echo ""
